<%- include('../partials/head', { title: labels.appTitle }) %>

<h1><%= labels.appTitle %></h1>
<!-- ðŸŒ Overall Summary Card -->
<div style="
  background: var(--card-bg, rgba(255,255,255,0.9));
  color: var(--text-color, #0f2f28);
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  padding: 1.5rem;
  margin: 1.5rem 0 2rem 0;
  text-align: center;
  transition: background 0.3s, color 0.3s;
">
  <h1 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 0.75rem;">
    ðŸ§­ Overall Travel Summary
  </h1>
  <div style="font-size: 2rem; font-weight: 700; color: var(--accent-color, #00897b);">
    <%= totalPoints ? totalPoints.toFixed(2) : 0 %> Points
  </div>
</div>

<h2>Streaks</h2>
<div class="card">
  <div class="chips">
    <div class="chip"><span class="dot dot-info"></span> Current: <strong><%= streaks.currentStreak %></strong></div>
    <div class="chip"><span class="dot dot-ok"></span> Longest Travel Planned: <strong><%= streaks.longestWin %></strong></div>
    <div class="chip"><span class="dot dot-bad"></span> Longest Not Interested: <strong><%= streaks.longestLoss %></strong></div>
  </div>
</div>

<h2>My Travel Stats</h2>
<div class="card">
  <table class="table">
    <tr>
      <th>Travel</th>
      <th>Series Points</th>
      <th>Planned</th>
      <th>Planners</th>
      <th>Not Interested</th>
      <th>Planner %</th>
    </tr>
    <% stats.forEach(s => { %>
  <tr>
    <td><%= s.seriesName %></td>
    <td><%= s.seriesPoints ? s.seriesPoints.toFixed(2) : 0 %></td>
    <td><%= s.planned %></td>
    <td><%= s.totalTravels %></td>
    <td><%= s.notInterested %></td>
    <td><%= s.plannerPercent || 0 %>%</td>
  </tr>
<% }) %>
<% } else { %>
  <tr><td colspan="6" style="text-align:center;">No series data available</td></tr>
<% } %>

  </table>
</div>

<h2>
  Top Planners 
  <% if (typeof selectedSeriesId !== 'undefined' && selectedSeriesId) { %>
    (Travel: <%= selectedSeriesName || selectedSeriesId %>)
  <% } else { %>
    (All Travels)
  <% } %>
</h2>

<div class="card">
  <form method="GET" action="/dashboard" class="inline-form" style="margin-bottom:.75rem">
  <label for="seriesId"><strong>Filter by Travel:</strong></label>
  <select name="seriesId" id="seriesId" onchange="this.form.submit()">
    <option value="">All Travels</option>
    <% seriesStats.forEach(s => { %>
      <option value="<%= s.series_id %>" <%= (selectedSeriesId == s.series_id) ? 'selected' : '' %>>
        <%= s.name %>
      </option>
    <% }) %>
  </select>
</form>

  <% if (seriesUnsupported) { %>
    <div class="chips" style="margin-bottom:.5rem">
      <div class="chip"><span class="dot dot-info"></span>
        Travel filtering is not supported by the current data schema; showing global totals.
      </div>
    </div>
  <% } else { %>
    <div class="chips" style="margin-bottom:.5rem">
      <div class="chip"><span class="dot dot-ok"></span> Top 3 planners are highlighted</div>
      <div class="chip"><span class="dot dot-info"></span>
        Points are <%= selectedSeriesId ? 'for the selected travel only' : 'cumulative across all travels' %>
      </div>
    </div>
  <% } %>

  <table class="table">
    <tr><th>#</th><th>Planner</th><th>Badge</th><th>Points</th></tr>
    <% leaderboard.forEach((l, idx) => { 
         const medal = idx===0 ? 'ðŸ¥‡' : idx===1 ? 'ðŸ¥ˆ' : idx===2 ? 'ðŸ¥‰' : 'â€”'; %>
      <tr>
        <td><%= idx+1 %></td>
        <td><a href="/dashboard/player/<%= l.user_id %>"><%= l.display_name %></a></td>
        <td><%= medal %></td>
        <td><%= l.points.toFixed ? l.points.toFixed(2) : l.points %></td>
      </tr>
    <% }) %>
  </table>
</div>

<%- include('../partials/foot') %>
