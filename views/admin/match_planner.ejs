<%- include('../partials/head', { title: title }) %>

<h1>Planner â€” <%= match.name %></h1>
<a class="btn btn-link" href="/admin/series/<%= match.series_id %>/matches">â† Back to Travels</a>

<div class="card" style="margin-top:1rem;">
  <div class="travel-meta">
    <strong>Destinations:</strong> <%= match.team_a %> OR <%= match.team_b %><br>
    <strong>Start (IST):</strong>
    <%= moment.utc(match.start_time_utc).tz('Asia/Kolkata').format('YYYY-MM-DD HH:mm') %><br>
    <strong>Points:</strong> <%= match.entry_points %><br>
    <strong>Status:</strong> <%= match.status %>
  </div>
</div>

<hr>

<!-- Probable Result -->
<div class="card" style="margin:1rem 0;">
  <h3>ğŸ”® Probable Winning (After Cutoff)</h3>
  <% if (isCutoffPassed) { %>
    <p><strong><%= probable %></strong></p>
  <% } else { %>
    <p>Probable result will be shown after cutoff.</p>
  <% } %>
</div>

<!-- Summary -->
<div class="summary-box" style="display:flex;gap:1rem;margin:1rem 0;">
  <div class="chip chip-ok">ğŸ• <%= match.team_a %>: <%= countA %> planners</div>
  <div class="chip chip-warn">ğŸ– <%= match.team_b %>: <%= countB %> planners</div>
</div>

<!-- Travel Planners -->
<div class="card">
  <h3>ğŸ§­ Travel Planners</h3>
  <% if (predictions.length === 0) { %>
    <p>No planners yet.</p>
  <% } else { %>
    <table class="table">
      <thead>
        <tr><th>Planner</th><th>Chosen Destination</th></tr>
      </thead>
      <tbody>
        <% predictions.forEach(p => { %>
          <tr>
            <td><%= p.display_name %></td>
            <td><%= p.predicted_team === 'A' ? match.team_a : match.team_b %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</div>

<!-- Admin Declare Controls -->
<% if (match.status !== 'completed' && match.status !== 'washed_out') { %>
  <hr>
  <div class="card" style="margin-top:1rem;">
    <h3>âš–ï¸ Declare Result</h3>
    <form method="POST" action="/admin/matches/<%= match.id %>/declare" style="display:flex;gap:1rem;flex-wrap:wrap;">
      <button class="btn btn-success" name="winner" value="A" type="submit">
        âœ… Declare <%= match.team_a %>
      </button>
      <button class="btn btn-success" name="winner" value="B" type="submit">
        âœ… Declare <%= match.team_b %>
      </button>
      <button class="btn btn-warning" name="washed_out" value="true" type="submit">
        ğŸŒ§ Washed Out
      </button>
      <button class="btn btn-danger" name="cancelled" value="true" type="submit"
              onclick="return confirm('Are you sure you want to cancel this travel?');">
        âŒ Cancel Travel
      </button>
    </form>
  </div>
<% } %>

<%- include('../partials/foot') %>
